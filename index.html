<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enquetes - Poker de Quinta</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Roboto:wght@300;400;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Roboto', sans-serif;background:#0d1b0d;color:#fff;min-height:100vh}
.logo-top{text-align:center;padding:20px}
.logo-top img{max-width:200px}
.container{max-width:1000px;margin:auto;padding:20px}
header{text-align:center;background:#102810;border:2px solid #d4a121;border-radius:15px;padding:30px;margin-bottom:30px}
h1{font-family:'Anton';color:#d4a121;letter-spacing:3px}
.subtitle{margin-top:10px}

.enquete-section{background:#102810;border:2px solid #d4a121;border-radius:12px;padding:25px;margin-bottom:25px}
.enquete-section h2{font-family:'Anton';color:#d4a121;margin-bottom:20px;font-size:1.8em}

.vote-option{background:rgba(255,255,255,.05);padding:15px;border-radius:10px;margin-bottom:10px;cursor:pointer;border:2px solid transparent;transition:all 0.3s}
.vote-option:hover{border-color:#d4a121;background:rgba(212,161,33,.1)}
.vote-option.selected{border-color:#d4a121;background:rgba(212,161,33,.2)}
.option-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
.option-name{font-weight:bold;font-size:1.1em}
.option-votes{color:#d4a121;font-weight:bold}
.progress-bar{background:#1a3d1a;height:8px;border-radius:4px;overflow:hidden;margin-top:8px}
.progress-fill{background:#d4a121;height:100%;transition:width 0.3s}

.form-group{margin-bottom:20px}
.form-group label{color:#d4a121;font-weight:bold;display:block;margin-bottom:8px}
.form-group select{width:100%;padding:12px;border-radius:8px;border:1px solid #2d5016;background:#1a3d1a;color:#fff;font-size:1em}

.vote-btn{width:100%;padding:15px;background:#d4a121;border:none;border-radius:10px;font-weight:bold;cursor:pointer;color:#000;font-size:1.1em;margin-top:15px}
.vote-btn:disabled{opacity:0.5;cursor:not-allowed}

.voters-list{margin-top:15px;padding-top:15px;border-top:1px solid rgba(212,161,33,.3)}
.voters-list h4{color:#d4a121;margin-bottom:10px;font-size:0.9em}
.voter-tag{display:inline-block;background:#2d5016;padding:4px 10px;border-radius:15px;margin:3px;font-size:0.85em}

.status-indicator{position:fixed;top:10px;right:10px;background:#2d5016;padding:8px 15px;border-radius:20px;font-size:0.85em;border:1px solid #d4a121}
.status-indicator.connected{background:#1a3d1a;border-color:#4CAF50}

.results-section{background:#102810;border:2px dashed #d4a121;border-radius:12px;padding:20px;margin-top:20px}
.result-item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(212,161,33,.2)}
.result-item:last-child{border:none}

.dashboard{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:25px}
.dashboard-card{background:#102810;border:2px solid #d4a121;border-radius:12px;padding:20px;text-align:center}
.dashboard-card .card-icon{font-size:2.5em;margin-bottom:10px}
.dashboard-card h3{font-family:'Anton';color:#d4a121;font-size:0.9em;margin-bottom:10px;letter-spacing:1px}
.dashboard-card .card-value{font-family:'Anton';font-size:1.4em;color:#fff;margin-bottom:5px;min-height:40px}
.dashboard-card .card-detail{color:#d4a121;font-size:0.9em;opacity:0.9}

.add-btn{width:100%;padding:15px;background:#d4a121;border:none;border-radius:10px;font-weight:bold;cursor:pointer;margin-bottom:10px;color:#000}
.remove-vote-btn{background:#c72c48;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;font-size:0.85em;margin-left:5px}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);justify-content:center;align-items:center;z-index:1000}
.modal.active{display:flex}
.modal-content{background:#102810;border:2px solid #d4a121;border-radius:15px;padding:30px;width:90%;max-width:500px}
.modal-buttons{display:flex;gap:10px;margin-top:20px}
.modal-btn{flex:1;padding:10px;font-weight:bold;border:none;border-radius:8px;cursor:pointer}
.modal-btn.confirm{background:#d4a121;color:#000}
.modal-btn.cancel{background:#c72c48;color:#fff}

@media(max-width:768px){
.option-header{flex-direction:column;align-items:flex-start;gap:5px}
.dashboard{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="status-indicator" id="statusIndicator">üîÑ Conectando...</div>

<div class="logo-top">
<img src="logo pdq.png" onerror="this.style.display='none'">
</div>

<div class="container">

<header>
<h1>ENQUETES POKER DE QUINTA</h1>
<div class="subtitle">üìä Vote nas op√ß√µes da pr√≥xima etapa</div>
</header>

<!-- DASHBOARD DE RESULTADOS -->
<div class="dashboard" id="dashboard">
<div class="dashboard-card">
<div class="card-icon">üçΩÔ∏è</div>
<h3>JANTA MAIS VOTADA</h3>
<div class="card-value" id="dashJantaVencedor">-</div>
<div class="card-detail" id="dashJantaVotos">0 votos</div>
</div>
<div class="dashboard-card">
<div class="card-icon">üé¥</div>
<h3>M√ÉO MAIS VOTADA</h3>
<div class="card-value" id="dashMaoVencedor">-</div>
<div class="card-detail" id="dashMaoVotos">0 votos</div>
</div>
<div class="dashboard-card">
<div class="card-icon">üë•</div>
<h3>PARTICIPA√á√ÉO</h3>
<div class="card-value" id="dashParticipacao">0%</div>
<div class="card-detail" id="dashTotalVotos">0 votantes</div>
</div>
</div>

<div class="form-group">
<label>üë§ Selecione seu nome para votar</label>
<select id="playerSelect">
<option value="">Escolha seu nome...</option>
</select>
</div>

<!-- ENQUETE 1: JANTA -->
<div class="enquete-section" id="enqueteJanta">
<h2>üçΩÔ∏è ENQUETE: JANTA</h2>
<div style="background: rgba(212, 161, 33, 0.1); border: 2px dashed #d4a121; border-radius: 10px; padding: 15px; margin-bottom: 20px;" id="avisoJanta">
<p style="margin-bottom: 10px; font-weight: bold; color: #d4a121;">‚è∞ Vota√ß√£o encerra Segunda-feira √†s 22:00</p>
<p style="opacity: 0.9; line-height: 1.6;">O prazo √© necess√°rio para que nosso lend√°rio <strong>Bruxo da Cozinha</strong> üßô‚Äç‚ôÇÔ∏è possa preparar a deliciosa janta que todos merecem! Quanto mais cedo voc√™ votar, melhor ser√° o resultado.</p>
</div>

<!-- CONTADOR REGRESSIVO - VAI APARECER AQUI -->
<div id="contadorRegressivoContainer" style="display: none;">
  <!-- O contador ser√° inserido aqui pelo JavaScript -->
</div>

<p style="margin-bottom:20px;opacity:0.9">Escolha sua op√ß√£o preferida para a janta:</p>
<div id="jantaOptions"></div>
<button class="vote-btn" id="btnVotarJanta" disabled>VOTAR NA JANTA</button>
<div class="results-section" id="jantaResults" style="display:none">
<h3 style="color:#d4a121;margin-bottom:15px">üìä Resultados</h3>
<div id="jantaResultsList"></div>
</div>
</div>

<!-- ENQUETE 2: M√ÉO DA ETAPA -->
<div class="enquete-section">
<h2>üé¥ ENQUETE: M√ÉO DA ETAPA</h2>
<div style="background: rgba(212, 161, 33, 0.1); border: 2px dashed #d4a121; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
<p style="margin-bottom: 10px; font-weight: bold; color: #d4a121;">üé∞ A M√£o da Etapa ativa a Roleta da Sorte!</p>
<p style="opacity: 0.9; line-height: 1.6;">Quem <strong>ganhar a m√£o</strong> com as cartas escolhidas e tiver <strong>showdown</strong> fica eleg√≠vel a girar a <strong>Roleta da Sorte</strong> üé° e concorrer a pr√™mios especiais!</p>
<p style="margin-top: 10px; font-size: 0.95em; opacity: 0.85;">üìã Para mais informa√ß√µes, <a href="https://pokerdequinta.github.io/regulamento/" style="color: #d4a121; font-weight: bold; text-decoration: underline;">Leia o Regulamento</a></p>
</div>
<p style="margin-bottom:20px;opacity:0.9">Vote na sua m√£o favorita da etapa:</p>
<div id="maoOptions"></div>
<button class="vote-btn" id="btnVotarMao" disabled>VOTAR NA M√ÉO</button>
<div class="results-section" id="maoResults" style="display:none">
<h3 style="color:#d4a121;margin-bottom:15px">üìä Resultados</h3>
<div id="maoResultsList"></div>
</div>
</div>

</div>

<button class="add-btn" id="btnModoAdmin" style="position:fixed;bottom:10px;right:10px;width:auto;padding:8px 15px;background:rgba(13,27,13,0.3);border:1px solid rgba(212,161,33,0.1);opacity:0.15;font-size:0.7em;transition:opacity 0.3s">üîê</button>

<div class="modal" id="modalAdmin">
<div class="modal-content">
<h2 style="color: #8b0000;">üîê Modo Administrador</h2>
<p style="margin: 15px 0; opacity: 0.8;">Digite a senha de administrador para acessar fun√ß√µes exclusivas:</p>
<div class="form-group">
<label>Senha Admin</label>
<input type="password" id="senhaAdmin" placeholder="Digite a senha">
</div>
<div class="modal-buttons">
<button class="modal-btn cancel" id="btnFecharAdmin">Cancelar</button>
<button class="modal-btn confirm" id="btnAcessarAdmin" style="background:#8b0000; color:#fff">Acessar</button>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, onValue, push, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyD_XXjcjJYM73wLTTzpDgzKCOZnztcJhjE",
  authDomain: "poker-de-quinta.firebaseapp.com",
  databaseURL: "https://poker-de-quinta-default-rtdb.firebaseio.com",
  projectId: "poker-de-quinta",
  storageBucket: "poker-de-quinta.firebasestorage.app",
  messagingSenderId: "776724152456",
  appId: "1:776724152456:web:fbffde9a1c1a7628c61f3d"
};

const jogadores = ["Amarildo","Boy","Buiu","Caio","Charles","Cleversson","Davi","Gera","Diego","Dos Anjos","Eduardo","Fernando","Gregory","Gaspar","Guilherme","Guti","Igor","Izidio","Jean","Jean Rebuy","Junior","Leo","Loreto","Lucas","Matheus","Maykon","Neto","Nil","Peterson","Rafael","Ricardo Amarante","Ricardo Linhares","Ricardo Matoso","Robson","Sergio","Solano","Tigre","Van Van","Waltinho","Wesley"];

const opcoesJanta = [
  "Vaca Atolada",
  "Strogonoff",
  "Frango Assado com Arroz",
  "Quirera com Su√£",
  "P√£o Com Pernil",
  "Arroz Carreteiro",
  "Carne de Panela",
  "Dobradinha"
];

const opcoesMao = [
  "7 e 2 OFF",
  "K e 3 OFF",
  "Q e 2 OFF",
  "J e 4 OFF",
  "10 e 2 OFF"
];

let db;
let votosJanta = {};
let votosMao = {};
let jantaSelecionada = null;
let maoSelecionada = null;
let jogadorAtual = null;
let modoAdmin = false;

// FUN√á√ÉO PARA VERIFICAR PRAZO DE VOTA√á√ÉO
function verificarPrazoVotacao() {
  // Data limite: 26 de janeiro de 2026 √†s 22:00
  const dataLimite = new Date('2026-01-26T22:00:00');
  const agora = new Date();
  
  if (agora >= dataLimite) {
    return {
      expirado: true,
      mensagem: '‚è∞ A vota√ß√£o da janta foi encerrada!',
      motivo: 'Prazo finalizado em 26/01 √†s 22:00'
    };
  }
  
  return { expirado: false };
}

// FUN√á√ÉO SIMPLES PARA CONTADOR REGRESSIVO
function iniciarContadorRegressivo() {
  const container = document.getElementById('contadorRegressivoContainer');
  
  // Para TESTE: usar amanh√£ √†s 22:00
  const dataLimite = new Date();
  dataLimite.setDate(dataLimite.getDate() + 1); // Amanh√£
  dataLimite.setHours(22, 0, 0, 0); // 22:00
  
  // Para produ√ß√£o: usar a data real
  // const dataLimite = new Date('2026-01-26T22:00:00');
  
  function atualizarContador() {
    const agora = new Date();
    const diff = dataLimite - agora;
    
    if (diff <= 0) {
      container.innerHTML = `
        <div style="background: rgba(139, 0, 0, 0.3); border: 2px solid #ff0000; border-radius: 10px; padding: 12px; margin: 15px 0; text-align: center;">
          <div style="font-weight: bold; color: #ff6b6b; font-size: 1.1em;">‚è∞ VOTA√á√ÉO ENCERRADA</div>
          <div style="margin-top: 5px; font-size: 0.9em;">Prazo finalizado em 26/01 √†s 22:00</div>
        </div>
      `;
      return;
    }
    
    const horas = Math.floor(diff / (1000 * 60 * 60));
    const minutos = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const segundos = Math.floor((diff % (1000 * 60)) / 1000);
    
    // Determinar cor com base no tempo
    let corFundo, corBorda, corTexto;
    
    if (horas > 24) {
      corFundo = 'rgba(212, 161, 33, 0.2)';
      corBorda = '#d4a121';
      corTexto = '#ffd700';
    } else if (horas > 6) {
      corFundo = 'rgba(255, 152, 0, 0.2)';
      corBorda = '#ff9800';
      corTexto = '#ffcc80';
    } else {
      corFundo = 'rgba(244, 67, 54, 0.2)';
      corBorda = '#f44336';
      corTexto = '#ffab91';
    }
    
    container.style.display = 'block';
    container.innerHTML = `
      <div style="background: ${corFundo}; border: 2px solid ${corBorda}; border-radius: 10px; padding: 12px; margin: 15px 0; text-align: center; animation: pulse 2s infinite;">
        <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
          <span style="font-size: 1.3em;">‚è≥</span>
          <span style="flex-grow: 1; text-align: center;">
            <strong style="color: ${corTexto};">TEMPO RESTANTE:</strong><br>
            <span style="font-size: 1.2em; letter-spacing: 1px; color: ${corTexto};">${horas}h ${minutos}m ${segundos}s</span>
          </span>
          <span style="font-size: 1.3em;">‚è≥</span>
        </div>
        <div style="margin-top: 5px; font-size: 0.85em; opacity: 0.9;">
          Vota√ß√£o encerra: <strong>26/01/2026 √†s 22:00</strong>
        </div>
      </div>
    `;
  }
  
  // Adicionar estilo de anima√ß√£o
  if (!document.querySelector('#contadorStyle')) {
    const style = document.createElement('style');
    style.id = 'contadorStyle';
    style.textContent = `
      @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(212, 161, 33, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(212, 161, 33, 0); }
        100% { box-shadow: 0 0 0 0 rgba(212, 161, 33, 0); }
      }
    `;
    document.head.appendChild(style);
  }
  
  // Atualizar a cada segundo
  atualizarContador();
  setInterval(atualizarContador, 1000);
}

// FUN√á√ÉO PARA EXIBIR JANTA VENCEDORA
function exibirJantaVencedora() {
  const prazo = verificarPrazoVotacao();
  const resultsContainer = document.getElementById('jantaResults');
  const resultsList = document.getElementById('jantaResultsList');
  
  if (prazo.expirado) {
    let votosPorJanta = {};
    Object.values(votosJanta).forEach(voto => {
      votosPorJanta[voto.opcao] = (votosPorJanta[voto.opcao] || 0) + 1;
    });
    
    let jantaVencedora = '-';
    let maxVotos = 0;
    let empate = false;
    
    Object.entries(votosPorJanta).forEach(([opcao, votos]) => {
      if (votos > maxVotos) {
        maxVotos = votos;
        jantaVencedora = opcao;
        empate = false;
      } else if (votos === maxVotos && maxVotos > 0) {
        empate = true;
      }
    });
    
    const mensagemVencedora = empate 
      ? 'üèÜ EMPATE! Mais de uma op√ß√£o recebeu o mesmo n√∫mero de votos, Organiza√ß√£o Decidir√°.'
      : `üèÜ JANTA VENCEDORA: ${jantaVencedora} (${maxVotos} voto${maxVotos !== 1 ? 's' : ''})`;
    
    const divVencedora = document.createElement('div');
    divVencedora.style.cssText = `
      background: linear-gradient(135deg, #d4a121, #b8860b);
      border: 3px solid #ffd700;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      color: #000;
      font-weight: bold;
      font-size: 1.2em;
      box-shadow: 0 4px 15px rgba(212, 161, 33, 0.5);
    `;
    
    divVencedora.innerHTML = `
      <div style="font-size: 2em; margin-bottom: 10px;">üéâ</div>
      <div>${mensagemVencedora}</div>
      <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
        Vota√ß√£o encerrada em ${prazo.motivo}
      </div>
    `;
    
    if (resultsList.firstChild) {
      resultsList.insertBefore(divVencedora, resultsList.firstChild);
    } else {
      resultsList.appendChild(divVencedora);
    }
    
    btnVotarJanta.disabled = true;
    btnVotarJanta.textContent = '‚è∞ VOTA√á√ÉO ENCERRADA';
    btnVotarJanta.style.background = '#666';
    
    document.getElementById('dashJantaVencedor').textContent = jantaVencedora;
    document.getElementById('dashJantaVotos').textContent = `${maxVotos} voto${maxVotos !== 1 ? 's' : ''}`;
  }
}

// FUN√á√ÉO PARA ATUALIZAR STATUS DO PRAZO
function atualizarStatusPrazo() {
  const prazo = verificarPrazoVotacao();
  const statusElement = document.getElementById('statusIndicator');
  
  if (prazo.expirado) {
    statusElement.innerHTML = '‚è∞ Vota√ß√£o da Janta ENCERRADA';
    statusElement.style.background = '#8b0000';
    statusElement.style.borderColor = '#ff0000';
    
    const avisoPrazo = document.getElementById('avisoJanta');
    if (avisoPrazo) {
      avisoPrazo.innerHTML = `
        <p style="margin-bottom: 10px; font-weight: bold; color: #ff6b6b;">‚è∞ VOTA√á√ÉO DA JANTA ENCERRADA</p>
        <p style="opacity: 0.9; line-height: 1.6;">
          A vota√ß√£o foi encerrada em <strong>${prazo.motivo}</strong>.<br>
          O Bruxo da Cozinha j√° est√° preparando a refei√ß√£o vencedora! üßô‚Äç‚ôÇÔ∏èüë®‚Äçüç≥
        </p>
      `;
    }
  }
}

try {
  const app = initializeApp(firebaseConfig);
  db = getDatabase(app);
  statusIndicator.textContent = '‚úÖ Conectado';
  statusIndicator.classList.add('connected');
  
  onValue(ref(db, 'enquetes/janta'), (snapshot) => {
    votosJanta = snapshot.val() || {};
    renderizarOpcoes('janta');
    atualizarDashboard();
    atualizarStatusPrazo();
  });
  
  onValue(ref(db, 'enquetes/mao'), (snapshot) => {
    votosMao = snapshot.val() || {};
    renderizarOpcoes('mao');
    atualizarDashboard();
  });
} catch (e) {
  statusIndicator.textContent = '‚ùå Erro de conex√£o';
  console.error(e);
}

// INICIAR CONTADOR REGRESSIVO IMEDIATAMENTE
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM carregado, iniciando contador...');
  iniciarContadorRegressivo();
});

// Preencher select de jogadores
const selectJogador = document.getElementById('playerSelect');
jogadores.sort().forEach(j => {
  const o = document.createElement('option');
  o.value = o.textContent = j;
  selectJogador.appendChild(o);
});

selectJogador.onchange = (e) => {
  jogadorAtual = e.target.value;
  btnVotarJanta.disabled = !jogadorAtual || !jantaSelecionada;
  btnVotarMao.disabled = !jogadorAtual || !maoSelecionada;
  renderizarOpcoes('janta');
  renderizarOpcoes('mao');
};

function renderizarOpcoes(tipo) {
  const opcoes = tipo === 'janta' ? opcoesJanta : opcoesMao;
  const votos = tipo === 'janta' ? votosJanta : votosMao;
  const container = document.getElementById(tipo + 'Options');
  const resultsContainer = document.getElementById(tipo + 'Results');
  const resultsList = document.getElementById(tipo + 'ResultsList');
  
  resultsList.innerHTML = '';
  
  if (tipo === 'janta') {
    const prazo = verificarPrazoVotacao();
    if (prazo.expirado) {
      opcoes.forEach(opcao => {
        const div = document.createElement('div');
        div.className = 'vote-option';
        div.style.opacity = '0.6';
        div.style.cursor = 'not-allowed';
        
        const numVotos = Object.values(votos).filter(v => v.opcao === opcao).length;
        const totalVotos = Object.keys(votos).length;
        const percentual = totalVotos > 0 ? (numVotos / totalVotos * 100).toFixed(1) : 0;
        
        div.innerHTML = `
          <div class="option-header">
            <span class="option-name">${opcao} üîí</span>
            <span class="option-votes">${numVotos} voto${numVotos !== 1 ? 's' : ''} (${percentual}%)</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:${percentual}%"></div>
          </div>
          <div style="margin-top: 10px; color: #d4a121; font-size: 0.9em;">
            ‚è∞ Vota√ß√£o encerrada
          </div>
        `;
        
        container.appendChild(div);
      });
      
      exibirJantaVencedora();
      resultsContainer.style.display = 'block';
      return;
    }
  }
  
  let totalVotos = 0;
  let votosPorOpcao = {};
  let votantesPorOpcao = {};
  
  Object.values(votos).forEach(voto => {
    totalVotos++;
    votosPorOpcao[voto.opcao] = (votosPorOpcao[voto.opcao] || 0) + 1;
    if (!votantesPorOpcao[voto.opcao]) votantesPorOpcao[voto.opcao] = [];
    votantesPorOpcao[voto.opcao].push(voto.jogador);
  });
  
  let jaVotou = false;
  let votoAnterior = null;
  Object.entries(votos).forEach(([key, voto]) => {
    if (voto.jogador === jogadorAtual) {
      jaVotou = true;
      votoAnterior = voto.opcao;
    }
  });
  
  container.innerHTML = '';
  opcoes.forEach(opcao => {
    const numVotos = votosPorOpcao[opcao] || 0;
    const percentual = totalVotos > 0 ? (numVotos / totalVotos * 100).toFixed(1) : 0;
    const isSelected = tipo === 'janta' ? jantaSelecionada === opcao : maoSelecionada === opcao;
    const jaVotouNesta = votoAnterior === opcao;
    
    const div = document.createElement('div');
    div.className = 'vote-option' + (isSelected ? ' selected' : '');
    div.onclick = () => {
      if (!jogadorAtual) {
        alert('Selecione seu nome primeiro!');
        return;
      }
      if (tipo === 'janta') {
        jantaSelecionada = opcao;
        btnVotarJanta.disabled = false;
      } else {
        maoSelecionada = opcao;
        btnVotarMao.disabled = false;
      }
      renderizarOpcoes(tipo);
    };
    
    div.innerHTML = `
      <div class="option-header">
        <span class="option-name">${opcao} ${jaVotouNesta ? '‚úÖ' : ''}</span>
        <span class="option-votes">${numVotos} voto${numVotos !== 1 ? 's' : ''} (${percentual}%)</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width:${percentual}%"></div>
      </div>
      ${numVotos > 0 ? `
        <div class="voters-list">
          <h4>Votaram nesta op√ß√£o:</h4>
          ${votantesPorOpcao[opcao].map(v => {
            const votoKey = Object.keys(votos).find(key => votos[key].jogador === v && votos[key].opcao === opcao);
            const btnRemover = modoAdmin ? `<button class="remove-vote-btn" onclick="removerVoto('${tipo}','${votoKey}')">‚ùå</button>` : '';
            return `<span class="voter-tag">${v}${btnRemover}</span>`;
          }).join('')}
        </div>
      ` : ''}
    `;
    
    container.appendChild(div);
  });
  
  if (totalVotos > 0) {
    resultsContainer.style.display = 'block';
    const ordenado = Object.entries(votosPorOpcao).sort((a, b) => b[1] - a[1]);
    resultsList.innerHTML = ordenado.map(([opcao, votos]) => `
      <div class="result-item">
        <strong>${opcao}</strong>
        <span>${votos} voto${votos !== 1 ? 's' : ''}</span>
      </div>
    `).join('');
  }
}

btnVotarJanta.onclick = async () => {
  if (!jogadorAtual || !jantaSelecionada) return;
  
  const prazo = verificarPrazoVotacao();
  if (prazo.expirado) {
    alert(`‚ùå ${prazo.mensagem}\n${prazo.motivo}`);
    return;
  }
  
  const votosRef = ref(db, 'enquetes/janta');
  const snapshot = await get(votosRef);
  if (snapshot.exists()) {
    const votos = snapshot.val();
    for (let key in votos) {
      if (votos[key].jogador === jogadorAtual) {
        await set(ref(db, `enquetes/janta/${key}`), null);
      }
    }
  }
  
  await push(ref(db, 'enquetes/janta'), {
    jogador: jogadorAtual,
    opcao: jantaSelecionada,
    data: new Date().toISOString()
  });
  
  alert('Voto registrado com sucesso! üéâ');
  jantaSelecionada = null;
  btnVotarJanta.disabled = true;
};

btnVotarMao.onclick = async () => {
  if (!jogadorAtual || !maoSelecionada) return;
  
  const votosRef = ref(db, 'enquetes/mao');
  const snapshot = await get(votosRef);
  if (snapshot.exists()) {
    const votos = snapshot.val();
    for (let key in votos) {
      if (votos[key].jogador === jogadorAtual) {
        await set(ref(db, `enquetes/mao/${key}`), null);
      }
    }
  }
  
  await push(ref(db, 'enquetes/mao'), {
    jogador: jogadorAtual,
    opcao: maoSelecionada,
    data: new Date().toISOString()
  });
  
  alert('Voto registrado com sucesso! üéâ');
  maoSelecionada = null;
  btnVotarMao.disabled = true;
};

function atualizarDashboard() {
  const prazo = verificarPrazoVotacao();
  
  if (prazo.expirado) {
    let votosPorJanta = {};
    Object.values(votosJanta).forEach(voto => {
      votosPorJanta[voto.opcao] = (votosPorJanta[voto.opcao] || 0) + 1;
    });
    
    let jantaVencedor = '-';
    let jantaMaxVotos = 0;
    Object.entries(votosPorJanta).forEach(([opcao, votos]) => {
      if (votos > jantaMaxVotos) {
        jantaMaxVotos = votos;
        jantaVencedor = opcao;
      }
    });
    
    document.getElementById('dashJantaVencedor').textContent = jantaVencedor;
    document.getElementById('dashJantaVotos').textContent = `${jantaMaxVotos} voto${jantaMaxVotos !== 1 ? 's' : ''}`;
    document.getElementById('dashJantaVencedor').style.color = '#ffd700';
    document.getElementById('dashJantaVotos').style.color = '#ffd700';
  } else {
    let votosPorJanta = {};
    let votantesJanta = new Set();
    Object.values(votosJanta).forEach(voto => {
      votosPorJanta[voto.opcao] = (votosPorJanta[voto.opcao] || 0) + 1;
      votantesJanta.add(voto.jogador);
    });
    
    let jantaVencedor = '-';
    let jantaMaxVotos = 0;
    Object.entries(votosPorJanta).forEach(([opcao, votos]) => {
      if (votos > jantaMaxVotos) {
        jantaMaxVotos = votos;
        jantaVencedor = opcao;
      }
    });
    document.getElementById('dashJantaVencedor').textContent = jantaVencedor;
    document.getElementById('dashJantaVotos').textContent = `${jantaMaxVotos} voto${jantaMaxVotos !== 1 ? 's' : ''}`;
    document.getElementById('dashJantaVencedor').style.color = '#fff';
    document.getElementById('dashJantaVotos').style.color = '#d4a121';
  }
  
  let votosPorMao = {};
  let votantesMao = new Set();
  Object.values(votosMao).forEach(voto => {
    votosPorMao[voto.opcao] = (votosPorMao[voto.opcao] || 0) + 1;
    votantesMao.add(voto.jogador);
  });
  
  let maoVencedor = '-';
  let maoMaxVotos = 0;
  Object.entries(votosPorMao).forEach(([opcao, votos]) => {
    if (votos > maoMaxVotos) {
      maoMaxVotos = votos;
      maoVencedor = opcao;
    }
  });
  document.getElementById('dashMaoVencedor').textContent = maoVencedor;
  document.getElementById('dashMaoVotos').textContent = `${maoMaxVotos} voto${maoMaxVotos !== 1 ? 's' : ''}`;
  
  const totalVotantes = new Set([...Object.values(votosJanta).map(v => v.jogador), ...Object.values(votosMao).map(v => v.jogador)]).size;
  const participacao = jogadores.length > 0 ? ((totalVotantes / jogadores.length) * 100).toFixed(1) : 0;
  document.getElementById('dashParticipacao').textContent = `${participacao}%`;
  document.getElementById('dashTotalVotos').textContent = `${totalVotantes} votante${totalVotantes !== 1 ? 's' : ''}`;
}

// Fun√ß√£o para remover voto (apenas admin)
window.removerVoto = async (tipo, votoKey) => {
  if (!modoAdmin) return;
  if (!confirm('Remover este voto?')) return;
  
  try {
    await set(ref(db, `enquetes/${tipo}/${votoKey}`), null);
    alert('Voto removido com sucesso!');
  } catch (e) {
    alert('Erro ao remover voto: ' + e.message);
  }
};

// Modo Admin
btnModoAdmin.onclick = () => modalAdmin.classList.add('active');
btnFecharAdmin.onclick = () => modalAdmin.classList.remove('active');
btnAcessarAdmin.onclick = () => {
  if (document.getElementById('senhaAdmin').value === "poker2026") {
    modoAdmin = true;
    modalAdmin.classList.remove('active');
    btnModoAdmin.style.background = '#4CAF50';
    btnModoAdmin.style.opacity = '1';
    alert("Modo Admin Ativado! Agora voc√™ pode remover votos.");
    renderizarOpcoes('janta');
    renderizarOpcoes('mao');
  } else {
    alert("Senha incorreta!");
  }
};

// Garantir que o contador seja iniciado
window.addEventListener('load', function() {
  console.log('P√°gina carregada, iniciando contador...');
  iniciarContadorRegressivo();
  
  // Bot√£o de teste para verificar se funciona
  const testBtn = document.createElement('button');
  testBtn.textContent = 'TESTAR CONTADOR';
  testBtn.style.cssText = 'position:fixed;bottom:60px;right:10px;padding:8px 12px;background:#2196F3;color:white;border:none;border-radius:5px;z-index:9999;font-size:0.8em;cursor:pointer;';
  testBtn.onclick = function() {
    iniciarContadorRegressivo();
    alert('Contador reiniciado! Verifique se apareceu.');
  };
  document.body.appendChild(testBtn);
});

</script>
</body>

</html>
